<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Giornalino WhatsApp</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#25d366">

  <!-- Apple / iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Giornalino">
  <link rel="apple-touch-icon" href="icons/192.png">

  <link rel="stylesheet" href="css/style.css">
</head>

<body>
<!-- DEBUG LOG -->
<div id="log"></div>

<header>
  <h1>ğŸ— Crea il tuo giornalino</h1>
  <button id="btnExport">Esporta & invia su WhatsApp</button>
</header>

<div style="padding: 0 16px;">
  <div class="btn-wrap">
    <button type="button" id="fakeBtn">ğŸ“· Scegli foto</button>
    <input type="file" id="imgInput" accept="image/*" class="file-btn">
  </div>
  <button type="button" id="btnDelImg">ğŸ—‘ Rimuovi</button>
</div>

<!-- CROP AREA -->
<div id="cropArea">
  <div id="cropContainer">
    <div id="cropHint">ğŸ‘‰ Usa due dita per zoom, trascina per spostare</div>
    
    <div id="cropCanvasWrapper">
      <canvas id="cropCanvas"></canvas>
    </div>
    
    <div class="crop-controls">
      <h3>ğŸ“ Formato</h3>
      <div class="preset-buttons">
        <button class="preset-btn active" data-ratio="1">Quadrato</button>
        <button class="preset-btn" data-ratio="1.778">16:9</button>
        <button class="preset-btn" data-ratio="1.333">4:3</button>
        <button class="preset-btn" data-ratio="0.75">Verticale</button>
      </div>
      
      <h3>ğŸ” Zoom</h3>
      <div class="zoom-control">
        <input type="range" id="zoomSlider" min="100" max="300" value="100" step="1">
        <div style="text-align: center; font-size: 12px; margin-top: 5px;">
          <span id="zoomValue">100%</span>
        </div>
      </div>
      
      <h3>â†”ï¸ Sposta</h3>
      <div class="pan-buttons">
        <button class="pan-btn" data-dir="up">â¬†ï¸</button>
        <button class="pan-btn" data-dir="left">â¬…ï¸</button>
        <button class="pan-btn" data-dir="right">â¡ï¸</button>
        <button class="pan-btn" data-dir="down">â¬‡ï¸</button>
      </div>
    </div>
    
    <div class="crop-actions">
      <button id="btnCropOK">âœ… Conferma</button>
      <button id="btnSkipCrop">ğŸ’¾ Usa originale</button>
      <button id="btnCropCancel">âŒ Annulla</button>
    </div>
  </div>
</div>

<main id="editor" class="canvas">
  <div class="grid">
    <div class="blocco titolo" contenteditable="true">Titolo del giornalino</div>
    <div class="blocco testo" contenteditable="true">Scrivi qui la notiziaâ€¦</div>
    <img class="blocco immagine" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect fill='%23ddd' width='400' height='300'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' fill='%23999' font-size='20'%3EImmagine predefinita%3C/text%3E%3C/svg%3E" alt="Foto">
  </div>
</main>

<div id="iosHelp" class="ios-banner" style="display:none">
  Per installare: Safari â†’ Condividi â†’ Aggiungi a Home
  <button onclick="this.parentElement.style.display='none'">OK</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="js/app.js"></script>

<script>
// Mostra banner iOS solo se non installato
if (/iPad|iPhone|iPod/.test(navigator.userAgent) && 
    !window.matchMedia('(display-mode: standalone)').matches) {
  document.getElementById('iosHelp').style.display = 'block';
}
</script>

</body>
</html>